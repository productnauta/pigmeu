# CITO (Content Copilot) - Data Model Documentation

---

## **1. Introduction**

### **1.1 Purpose**
This document describes the **data model** used in the **CITO (Content Copilot)** system, focusing on the **Minimum Viable Product (MVP)**. It defines the structure of MongoDB collections, fields, and relationships, ensuring consistency and clarity in data storage and retrieval.

### **1.2 Scope**
The data model described in this document covers:
- **MongoDB collections** used in the MVP.
- **Fields** and their data types.
- **Relationships** between collections.
- **Examples** of documents stored in each collection.

Post-MVP collections, such as those for WordPress integration, are not covered in this document.

### **1.3 Audience**
This document is intended for:
- **Developers** working on the CITO system.
- **Data architects** reviewing the data model.
- **Project managers** overseeing the development of CITO.

---

## **2. MongoDB Collections**

### **2.1 Collection: `original_sources`**
This collection stores the raw and sanitized HTML content, metadata, and TOC proposals for blog articles.

#### **Fields**
| Field | Type | Description | Required |
|-------|------|-------------|----------|
| `_id` | ObjectId | Unique identifier for the document. | Yes |
| `raw_html` | String | The raw HTML content of the blog article. | Yes |
| `sanitized_html` | String | The sanitized HTML content (without scripts, ads, or irrelevant content). | Yes |
| `sanitized_text` | String | The extracted text from the sanitized HTML. | Yes |
| `metadata` | Object | Metadata about the blog article. | Yes |
| `metadata.title` | String | The title of the blog article. | No |
| `metadata.author` | String | The author of the blog article. | No |
| `metadata.publication_date` | Date | The publication date of the blog article. | No |
| `metadata.url` | String | The URL of the blog article. | No |
| `metadata.language` | String | The language of the blog article (e.g., `en`, `pt`). | No |
| `toc_proposals` | Array | Array of TOC proposals generated by the AI model. | No |
| `toc_proposals[].title` | String | The proposed title for the blog article. | Yes |
| `toc_proposals[].toc` | Array | The structured TOC for the blog article. | Yes |
| `toc_proposals[].toc[].level` | String | The heading level (e.g., `h1`, `h2`, `h3`). | Yes |
| `toc_proposals[].toc[].text` | String | The text of the heading. | Yes |
| `toc_proposals[].toc[].children` | Array | Nested headings (e.g., subsections). | No |
| `ia_analysis` | Object | Initial analysis of the content performed by the AI model. | No |
| `ia_analysis.key_themes` | Array | List of key themes identified in the content. | No |
| `ia_analysis.key_themes[].theme` | String | A key theme identified in the content. | Yes |
| `ia_analysis.key_themes[].relevance` | Number | Relevance score of the theme (0-1). | No |
| `ia_analysis.sentiment` | String | Sentiment analysis of the content (e.g., `positive`, `neutral`, `negative`). | No |
| `ia_analysis.tone` | String | Tone analysis of the content (e.g., `formal`, `informal`, `technical`). | No |
| `created_at` | Date | Timestamp of when the document was created. | Yes |
| `updated_at` | Date | Timestamp of when the document was last updated. | No |

#### **Example Document**
```json
{
  "_id": "5f8d0d55b54764421b7156a8",
  "raw_html": "<html>...</html>",
  "sanitized_html": "<div>...</div>",
  "sanitized_text": "This is the extracted text from the blog article.",
  "metadata": {
    "title": "Sample Blog Article",
    "author": "John Doe",
    "publication_date": "2023-10-15T00:00:00.000Z",
    "url": "https://example.com/sample-article",
    "language": "en"
  },
  "toc_proposals": [
    {
      "title": "Sample Blog Article: A Comprehensive Guide",
      "toc": [
        {
          "level": "h1",
          "text": "Introduction",
          "children": [
            {
              "level": "h2",
              "text": "Purpose of This Article"
            }
          ]
        },
        {
          "level": "h1",
          "text": "Key Themes"
        }
      ]
    }
  ],
  "ia_analysis": {
    "key_themes": [
      {
        "theme": "AI in Content Creation",
        "relevance": 0.95
      }
    ],
    "sentiment": "neutral",
    "tone": "technical"
  },
  "created_at": "2023-10-15T10:00:00.000Z",
  "updated_at": "2023-10-15T10:30:00.000Z"
}
```

---

### **2.2 Collection: `content_generation_requests`**
This collection stores the context and results of content generation requests, including TOC proposals and generated titles.

#### **Fields**
| Field | Type | Description | Required |
|-------|------|-------------|----------|
| `_id` | ObjectId | Unique identifier for the document. | Yes |
| `request_id` | String | Unique identifier for the content generation request. | Yes |
| `context` | Object | The context object used for AI model execution. | Yes |
| `context.sanitized_text` | String | The sanitized text of the blog article. | Yes |
| `context.metadata` | Object | Metadata about the blog article. | Yes |
| `context.ia_analysis` | Object | Initial analysis of the content. | No |
| `generated_titles` | Array | Array of generated titles for the blog article. | No |
| `generated_titles[].title` | String | A generated title for the blog article. | Yes |
| `generated_titles[].confidence` | Number | Confidence score of the generated title (0-1). | No |
| `toc_proposals` | Array | Array of TOC proposals generated by the AI model. | No |
| `toc_proposals[].title` | String | The proposed title for the blog article. | Yes |
| `toc_proposals[].toc` | Array | The structured TOC for the blog article. | Yes |
| `status` | String | Status of the content generation request (e.g., `pending`, `completed`, `failed`). | Yes |
| `created_at` | Date | Timestamp of when the document was created. | Yes |
| `updated_at` | Date | Timestamp of when the document was last updated. | No |

#### **Example Document**
```json
{
  "_id": "6f8d0d55b54764421b7156a9",
  "request_id": "req_20231015_001",
  "context": {
    "sanitized_text": "This is the extracted text from the blog article.",
    "metadata": {
      "title": "Sample Blog Article",
      "author": "John Doe",
      "publication_date": "2023-10-15T00:00:00.000Z",
      "url": "https://example.com/sample-article",
      "language": "en"
    },
    "ia_analysis": {
      "key_themes": [
        {
          "theme": "AI in Content Creation",
          "relevance": 0.95
        }
      ],
      "sentiment": "neutral",
      "tone": "technical"
    }
  },
  "generated_titles": [
    {
      "title": "Sample Blog Article: A Comprehensive Guide",
      "confidence": 0.9
    }
  ],
  "toc_proposals": [
    {
      "title": "Sample Blog Article: A Comprehensive Guide",
      "toc": [
        {
          "level": "h1",
          "text": "Introduction",
          "children": [
            {
              "level": "h2",
              "text": "Purpose of This Article"
            }
          ]
        },
        {
          "level": "h1",
          "text": "Key Themes"
        }
      ]
    }
  ],
  "status": "completed",
  "created_at": "2023-10-15T10:00:00.000Z",
  "updated_at": "2023-10-15T10:30:00.000Z"
}
```

---

## **3. Relationships**

### **3.1 Relationship Between `original_sources` and `content_generation_requests`**
- The `original_sources` collection stores the raw and sanitized content, while the `content_generation_requests` collection stores the results of AI-driven content generation.
- A document in `content_generation_requests` references the `sanitized_text` and `metadata` from a document in `original_sources`.
- The `request_id` field in `content_generation_requests` can be used to trace back to the original content.

---

## **4. Data Validation**

### **4.1 JSON Schema Validation**
AI model outputs, such as TOC proposals, are validated against JSON schemas to ensure they conform to expected structures. For example:

#### **TOC Proposal Schema**
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "proposals": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "toc": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "level": { "type": "string", "enum": ["h1", "h2", "h3"] },
                "text": { "type": "string" },
                "children": { "type": "array" }
              },
              "required": ["level", "text"]
            }
          }
        },
        "required": ["title", "toc"]
      },
      "minItems": 3,
      "maxItems": 3
    }
  },
  "required": ["proposals"]
}
```

---

## **5. References**
- [CITO Requirements Documentation](../requirements.md)
- [CITO Architecture Documentation](../architecture.md)
- [CITO Pipeline Documentation](../pipeline.md)
- [CITO Prompt Framework Documentation](../prompts.md)